apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: backend-secrets
  namespace: trackdechets-backend
  labels:
    app.kubernetes.io/name: backend-secrets
    app.kubernetes.io/component: secrets
    app.kubernetes.io/part-of: trackdechets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: backend-secretstore
    kind: SecretStore
  target:
    name: backend-secrets
    creationPolicy: Owner
    template:
      type: Opaque
  data:
    # Database connections
    - secretKey: DATABASE_URL
      remoteRef:
        key: name:trackdechets-backend/database-url
    - secretKey: REDIS_URL
      remoteRef:
        key: name:trackdechets-backend/redis-url
    - secretKey: MONGO_URL
      remoteRef:
        key: name:trackdechets-backend/mongo-url
    - secretKey: ELASTIC_SEARCH_URL
      remoteRef:
        key: name:trackdechets-backend/elasticsearch-url

    # Application secrets
    - secretKey: API_TOKEN_SECRET
      remoteRef:
        key: name:trackdechets-backend/api-token-secret
    - secretKey: SESSION_SECRET
      remoteRef:
        key: name:trackdechets-backend/session-secret
    - secretKey: WEBHOOK_TOKEN_ENCRYPTION_KEY
      remoteRef:
        key: name:trackdechets-backend/webhook-token-encryption-key

    # External service credentials
    - secretKey: SIB_APIKEY
      remoteRef:
        key: name:trackdechets-backend/sib-apikey
    - secretKey: QUEUE_MONITOR_TOKEN
      remoteRef:
        key: name:trackdechets-backend/queue-monitor-token
    - secretKey: GOTENBERG_TOKEN
      remoteRef:
        key: name:trackdechets-backend/gotenberg-token
    - secretKey: GOTENBERG_URL
      remoteRef:
        key: name:trackdechets-backend/gotenberg-url
    - secretKey: SENTRY_DSN
      remoteRef:
        key: name:trackdechets-backend/sentry-dsn

    # INSEE API credentials
    - secretKey: INSEE_CLIENT_ID
      remoteRef:
        key: name:trackdechets-backend/insee-client-id
    - secretKey: INSEE_CLIENT_SECRET
      remoteRef:
        key: name:trackdechets-backend/insee-client-secret
    - secretKey: INSEE_USERNAME
      remoteRef:
        key: name:trackdechets-backend/insee-username
    - secretKey: INSEE_PASSWORD
      remoteRef:
        key: name:trackdechets-backend/insee-password

    # S3 Storage credentials
    - secretKey: S3_ENDPOINT
      remoteRef:
        key: name:trackdechets-backend/s3-endpoint
    - secretKey: S3_REGION
      remoteRef:
        key: name:trackdechets-backend/s3-region
    - secretKey: S3_ACCESS_KEY_ID
      remoteRef:
        key: name:trackdechets-backend/s3-access-key-id
    - secretKey: S3_SECRET_ACCESS_KEY
      remoteRef:
        key: name:trackdechets-backend/s3-secret-access-key
    - secretKey: S3_BUCKET
      remoteRef:
        key: name:trackdechets-backend/s3-bucket
    - secretKey: S3_REGISTRY_ERRORS_BUCKET
      remoteRef:
        key: name:trackdechets-backend/s3-registry-errors-bucket
    - secretKey: S3_REGISTRY_IMPORTS_BUCKET
      remoteRef:
        key: name:trackdechets-backend/s3-registry-imports-bucket
    - secretKey: S3_REGISTRY_EXPORTS_BUCKET
      remoteRef:
        key: name:trackdechets-backend/s3-registry-exports-bucket
    - secretKey: S3_TEXS_ANALYSIS_BUCKET
      remoteRef:
        key: name:trackdechets-backend/s3-texs-analysis-bucket
    - secretKey: S3_REGISTRY_MODELS_BUCKET
      remoteRef:
        key: name:trackdechets-backend/s3-registry-models-bucket
    - secretKey: S3_REGISTRY_EXHAUSTIVE_EXPORTS_BUCKET
      remoteRef:
        key: name:trackdechets-backend/s3-registry-exhaustive-exports-bucket
    - secretKey: S3_BSD_TEMPLATES_BUCKET
      remoteRef:
        key: name:trackdechets-backend/s3-bsd-templates-bucket

    # Company search (External Elasticsearch)
    - secretKey: TD_COMPANY_ELASTICSEARCH_URL
      remoteRef:
        key: name:trackdechets-backend/td-company-elasticsearch-url
    - secretKey: TD_COMPANY_ELASTICSEARCH_INDEX
      remoteRef:
        key: name:trackdechets-backend/td-company-elasticsearch-index
    - secretKey: TD_COMPANY_ELASTICSEARCH_CACERT
      remoteRef:
        key: name:trackdechets-backend/td-company-elasticsearch-cacert
    - secretKey: TD_COMPANY_ELASTICSEARCH_IGNORE_SSL
      remoteRef:
        key: name:trackdechets-backend/td-company-elasticsearch-ignore-ssl

    # Add any other backend-specific secrets here
    # Example: Gerico API credentials
    # - secretKey: GERICO_API_KEY
    #   remoteRef:
    #     key: name:trackdechets-backend/gerico-api-key
