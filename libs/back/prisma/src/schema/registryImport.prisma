model RegistryImport {
    id               String               @id @default(cuid())
    createdAt        DateTime             @default(now()) @db.Timestamptz(6)
    updatedAt        DateTime             @updatedAt @db.Timestamptz(6)
    status           RegistryImportStatus @default(PENDING)
    type             RegistryImportType
    s3FileKey        String
    originalFileName String

    numberOfErrors        Int @default(0)
    numberOfInsertions    Int @default(0)
    numberOfEdits         Int @default(0)
    numberOfCancellations Int @default(0)
    numberOfSkipped       Int @default(0)

    createdById String
    createdBy   User   @relation(fields: [createdById], references: [id])

    associations RegistryImportAssociation[]

    @@index([createdById], map: "_RegistryImportCreatedByIdIdx")
}

model RegistryImportAssociation {
    importId    String
    reportedFor String
    reportedAs  String

    import RegistryImport @relation(fields: [importId], references: [id], onDelete: Cascade)

    @@id([importId, reportedFor, reportedAs])
}

enum RegistryImportStatus {
    PENDING
    STARTED
    SUCCESSFUL
    PARTIALLY_SUCCESSFUL
    FAILED
    CANCELED
}

enum RegistryImportType {
    SSD
    INCOMING_WASTE
    INCOMING_TEXS
}

model RegistrySsd {
    id        String   @id @default(cuid())
    createdAt DateTime @default(now()) @db.Timestamptz(6)
    importId  String?

    isActive    Boolean @default(true)
    isCancelled Boolean @default(false)

    createdById String
    createdBy   User   @relation(fields: [createdById], references: [id])

    publicId                   String
    reportForSiret             String
    reportForName              String
    reportForAddress           String
    reportForCity              String
    reportForPostalCode        String
    reportAsSiret              String?
    weightValue                Float
    weightIsEstimate           Boolean
    volume                     Float?
    wasteCode                  String
    wasteCodeBale              String?
    wasteDescription           String
    secondaryWasteCodes        String[]      @default([])
    secondaryWasteDescriptions String[]      @default([])
    dispatchDate               DateTime?     @db.Timestamptz(6)
    useDate                    DateTime?     @db.Timestamptz(6)
    processingDate             DateTime      @db.Timestamptz(6)
    processingEndDate          DateTime?     @db.Timestamptz(6)
    operationCode              String
    operationMode              OperationMode
    product                    String
    administrativeActReference String
    destinationType            String
    destinationOrgId           String?
    destinationName            String?
    destinationAddress         String?
    destinationCity            String?
    destinationPostalCode      String?
    destinationCountryCode     String?

    registryLookups RegistryLookup[]

    @@index([importId], map: "_RegistrySsdImportIdIdx")
    @@index([publicId, reportForSiret], map: "_RegistrySsdPublicIdReportForSiretIdx")
}

model RegistryIncomingWaste {
    id        String   @id @default(cuid())
    createdAt DateTime @default(now()) @db.Timestamptz(6)
    importId  String?

    isActive    Boolean @default(true)
    isCancelled Boolean @default(false)

    createdById String
    createdBy   User   @relation(fields: [createdById], references: [id])

    publicId                  String
    reportForSiret            String
    reportForName             String
    reportForAddress          String
    reportForCity             String
    reportForPostalCode       String
    reportAsSiret             String?
    customInfo                String?
    wasteCode                 String
    wastePop                  Boolean
    wasteIsDangerous          Boolean?
    receptionDate             DateTime
    weighingHour              String?
    wasteDescription          String
    wasteCodeBale             String?
    weightValue               Float
    weightIsEstimate          Boolean
    volume                    Float?
    producerType              String
    producerOrgId             String?
    producerName              String?
    producerAddress           String?
    producerPostalCode        String?
    producerCity              String?
    producerCountryCode       String?
    municipalitiesInseeCodes  String[]
    municipalitiesNames       String[]
    senderType                String
    senderOrgId               String?
    senderName                String?
    senderAddress             String?
    senderPostalCode          String?
    senderCity                String?
    senderCountryCode         String?
    senderTakeOverAddress     String?
    senderTakeOverPostalCode  String?
    senderTakeOverCity        String?
    senderTakeOverCountryCode String?
    brokerSiret               String?
    brokerName                String?
    brokerReceiptNumber       String?
    traderSiret               String?
    traderName                String?
    traderReceiptNumber       String?
    ecoOrganismeSiret         String?
    ecoOrganismeName          String?
    operationCode             String
    noTraceability            Boolean?
    nextDestinationIsAbroad   Boolean?
    declarationNumber         String?
    notificationNumber        String?
    movementNumber            String?
    nextOperationCode         String?
    transporter1TransportMode TransportMode
    transporter1Type          String
    transporter1OrgId         String?
    transporter1ReceiptNumber String?
    transporter1Name          String?
    transporter1Address       String?
    transporter1PostalCode    String?
    transporter1City          String?
    transporter1CountryCode   String?
    transporter2TransportMode TransportMode?
    transporter2Type          String?
    transporter2OrgId         String?
    transporter2ReceiptNumber String?
    transporter2Name          String?
    transporter2Address       String?
    transporter2PostalCode    String?
    transporter2City          String?
    transporter2CountryCode   String?
    transporter3TransportMode TransportMode?
    transporter3Type          String?
    transporter3OrgId         String?
    transporter3ReceiptNumber String?
    transporter3Name          String?
    transporter3Address       String?
    transporter3PostalCode    String?
    transporter3City          String?
    transporter3CountryCode   String?
    transporter4TransportMode TransportMode?
    transporter4Type          String?
    transporter4OrgId         String?
    transporter4ReceiptNumber String?
    transporter4Name          String?
    transporter4Address       String?
    transporter4PostalCode    String?
    transporter4City          String?
    transporter4CountryCode   String?
    transporter5TransportMode TransportMode?
    transporter5Type          String?
    transporter5OrgId         String?
    transporter5ReceiptNumber String?
    transporter5Name          String?
    transporter5Address       String?
    transporter5PostalCode    String?
    transporter5City          String?
    transporter5CountryCode   String?

    @@index([importId], map: "_RegistryIncomingWasteImportIdIdx")
    @@index([publicId, reportForSiret], map: "_RegistryIncomingWastePublicIdReportForSiretIdx")
}

model RegistryIncomingTexs {
    id        String   @id @default(cuid())
    createdAt DateTime @default(now()) @db.Timestamptz(6)
    importId  String?

    isActive    Boolean @default(true)
    isCancelled Boolean @default(false)

    createdById String
    createdBy   User   @relation(fields: [createdById], references: [id])

    publicId                     String
    reportForSiret               String
    reportForName                String
    reportForAddress             String
    reportForCity                String
    reportForPostalCode          String
    reportAsSiret                String?
    customInfo                   String?
    wasteCode                    String
    wastePop                     Boolean
    wasteIsDangerous             Boolean?
    receptionDate                DateTime
    wasteDescription             String
    wasteCodeBale                String?
    dap                          String?
    weightValue                  Float
    weightIsEstimate             Boolean
    volume                       Float?
    parcelInseeCodes             String[]
    parcelNumbers                String[]
    parcelCoordinates            String[]
    sisIdentifiers               String[]
    producerType                 String
    producerOrgId                String?
    producerName                 String?
    producerAddress              String?
    producerPostalCode           String?
    producerCity                 String?
    producerCountryCode          String?
    municipalitiesInseeCodes     String[]
    municipalitiesNames          String[]
    senderType                   String
    senderOrgId                  String?
    senderName                   String?
    senderTakeOverAddress        String?
    senderTakeOverPostalCode     String?
    senderTakeOverCity           String?
    senderTakeOverCountryCode    String?
    senderAddress                String?
    senderPostalCode             String?
    senderCity                   String?
    senderCountryCode            String?
    brokerSiret                  String?
    brokerName                   String?
    brokerReceiptNumber          String?
    traderSiret                  String?
    traderName                   String?
    traderReceiptNumber          String?
    operationCode                String
    noTraceability               Boolean?
    nextDestinationIsAbroad      Boolean?
    declarationNumber            String?
    notificationNumber           String?
    movementNumber               String?
    nextOperationCode            String?
    isUpcycled                   Boolean?
    destinationParcelInseeCodes  String[]
    destinationParcelNumbers     String[]
    destinationParcelCoordinates String[]
    transporter1TransportMode    TransportMode
    transporter1Type             String
    transporter1OrgId            String?
    transporter1ReceiptNumber    String?
    transporter1Name             String?
    transporter1Address          String?
    transporter1PostalCode       String?
    transporter1City             String?
    transporter1CountryCode      String?
    transporter2TransportMode    TransportMode?
    transporter2Type             String?
    transporter2OrgId            String?
    transporter2ReceiptNumber    String?
    transporter2Name             String?
    transporter2Address          String?
    transporter2PostalCode       String?
    transporter2City             String?
    transporter2CountryCode      String?
    transporter3TransportMode    TransportMode?
    transporter3Type             String?
    transporter3OrgId            String?
    transporter3ReceiptNumber    String?
    transporter3Name             String?
    transporter3Address          String?
    transporter3PostalCode       String?
    transporter3City             String?
    transporter3CountryCode      String?
    transporter4TransportMode    TransportMode?
    transporter4Type             String?
    transporter4OrgId            String?
    transporter4ReceiptNumber    String?
    transporter4Name             String?
    transporter4Address          String?
    transporter4PostalCode       String?
    transporter4City             String?
    transporter4CountryCode      String?
    transporter5TransportMode    TransportMode?
    transporter5Type             String?
    transporter5OrgId            String?
    transporter5ReceiptNumber    String?
    transporter5Name             String?
    transporter5Address          String?
    transporter5PostalCode       String?
    transporter5City             String?
    transporter5CountryCode      String?
}
