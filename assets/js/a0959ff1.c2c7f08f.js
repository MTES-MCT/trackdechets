(self.webpackChunktd_doc=self.webpackChunktd_doc||[]).push([[3779],{35722:function(e,t,a){"use strict";var i=a(67294),n=a(21140),s=a.n(n);s().initialize({startOnLoad:!0});t.Z=function(e){var t=e.chart;return(0,i.useEffect)((function(){s().contentLoaded()}),[]),i.createElement("div",{className:"mermaid"},t)}},54017:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return d},metadata:function(){return o},toc:function(){return u},default:function(){return c}});var i=a(22122),n=a(19756),s=(a(67294),a(3905)),r=a(35722),l=["components"],d={title:"Cycle de vie du BSDASRI"},o={unversionedId:"bsdasri/workflow",id:"bsdasri/workflow",isDocsHomePage:!1,title:"Cycle de vie du BSDASRI",description:"Avertissement: l'impl\xe9mentation Dasri et cette documentation constituent une version Beta et sont destin\xe9es \xe0 l'\xe9valuation des int\xe9grateurs. L'api est suceptible d'\xe9voluer",source:"@site/docs/bsdasri/workflow.md",sourceDirName:"bsdasri",slug:"/bsdasri/workflow",permalink:"/bsdasri/workflow",editUrl:"https://github.com/MTES-MCT/trackdechets/doc/docs/bsdasri/workflow.md",version:"current",frontMatter:{title:"Cycle de vie du BSDASRI"},sidebar:"docs",previous:{title:"Regroupement",permalink:"/bsdasri/regroupement"},next:{title:"Queries",permalink:"/api-reference/bsdd/queries"}},u=[{value:"Num\xe9ro de DASRI",id:"num\xe9ro-de-dasri",children:[]},{value:"Concepts",id:"concepts",children:[]},{value:"\xc9tats du DASRI",id:"\xe9tats-du-dasri",children:[]}],p={toc:u};function c(e){var t=e.components,a=(0,n.Z)(e,l);return(0,s.kt)("wrapper",(0,i.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("p",null,(0,s.kt)("em",{parentName:"p"},"Avertissement: l'impl\xe9mentation Dasri et cette documentation constituent une version Beta et sont destin\xe9es \xe0 l'\xe9valuation des int\xe9grateurs. L'api est suceptible d'\xe9voluer")),(0,s.kt)("h2",{id:"num\xe9ro-de-dasri"},"Num\xe9ro de DASRI"),(0,s.kt)("p",null,"Chaque DASRI est associ\xe9 \xe0 un identifiant lisible unique. Cet identifiant correspond au champ ",(0,s.kt)("inlineCode",{parentName:"p"},"id"),' et doit \xeatre utilis\xe9 lors des diff\xe9rentes requ\xeates. Cet identifiant apparait sur le bordereau dans la case "Bordereau n\xb0". L\'identifiant est sous la forme ',(0,s.kt)("inlineCode",{parentName:"p"},"DASRI-{YYYYMMDD}-{identifiant al\xe9atoire}")," (Ex: ",(0,s.kt)("inlineCode",{parentName:"p"},'"DASRI-20210118-RTAQRJA6P"'),"). Il peut \xeatre utiliser pour r\xe9cup\xe9rer l'identifiant opaque unique via la query ",(0,s.kt)("inlineCode",{parentName:"p"},"bsdasri"),"."),(0,s.kt)("h2",{id:"concepts"},"Concepts"),(0,s.kt)("p",null,"Le mode op\xe9ratoire diff\xe8re sensiblement de celui des BSDD."),(0,s.kt)("p",null,"le champ ",(0,s.kt)("inlineCode",{parentName:"p"},"id")," stocke un champ lisible (\xe9quivalent du ",(0,s.kt)("inlineCode",{parentName:"p"},"readableId")," du bsdd). Il n'y a donc pas de champ ",(0,s.kt)("inlineCode",{parentName:"p"},"readableId"),".\nLe ",(0,s.kt)("inlineCode",{parentName:"p"},"DRAFT")," est sorti des statuts, c'est un boolean \xe0 part. Le passage par l'\xe9tape brouillon est facultatif."),(0,s.kt)("p",null,"Pour donner plus de flexibilit\xe9 et limiter les mutations, les principes suivants sont adopt\xe9s:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"le nombre de mutations est reduit: createBsdasri/createDraftBsdasri, publishBsdasri,updateBsdasri, signBsdasri"),(0,s.kt)("li",{parentName:"ul"},"createDraftBsdasri cr\xe9e un dasri dans l'\xe9tat ",(0,s.kt)("inlineCode",{parentName:"li"},"INITIAL"),", ",(0,s.kt)("inlineCode",{parentName:"li"},"isDraft=true"),". Cette mutation est optionelle, on peut commencer avec ",(0,s.kt)("inlineCode",{parentName:"li"},"createBsdasri")),(0,s.kt)("li",{parentName:"ul"},"createBsdasri cr\xe9e un dasri dans l'\xe9tat ",(0,s.kt)("inlineCode",{parentName:"li"},"INITIAL"),", ",(0,s.kt)("inlineCode",{parentName:"li"},"isDraft=false")),(0,s.kt)("li",{parentName:"ul"},"publishBsdasri passe le dasri de ",(0,s.kt)("inlineCode",{parentName:"li"},"isDraft=true")," \xe0 ",(0,s.kt)("inlineCode",{parentName:"li"},"isDraft=false")),(0,s.kt)("li",{parentName:"ul"},"la mutation updateBsdasri permet de mettre \xe0 jour les dasri pendant leur cycle de vie"),(0,s.kt)("li",{parentName:"ul"},"la mutation signBsdasri (EMISSION, TRANSPORT, RECPTION, OPERATION) appose une signature sur le cadre correspondant et verrouille les champs correspondants"),(0,s.kt)("li",{parentName:"ul"},"une fois qu'une signature est appos\xe9e, champs du cadre correspondant ne sont plus modifiables"),(0,s.kt)("li",{parentName:"ul"},"signBsdasri (EMISSION) verrouille tous les champs emitter/emission"),(0,s.kt)("li",{parentName:"ul"},"signBsdasri (TRANSPORT) verrouille tous les champs transporter/transport, sauf la date de remise \xe0 l'installation destinataire ({transport { handedOverAt}}\n)"),(0,s.kt)("li",{parentName:"ul"},"signBsdasri (RECEPTION) verrouille tous les champs recipient, et les champ reception"),(0,s.kt)("li",{parentName:"ul"},"signBsdasri (OPERATION) verrouille les champ operation"),(0,s.kt)("li",{parentName:"ul"},"si le champ wasteAcceptation ({transport {wasteAcceptation}}) est REFUSED signBsdasri (TRANSPORT) passe le dasri \xe0 l'\xe9tat REFUSED"),(0,s.kt)("li",{parentName:"ul"},"si le champ wasteAcceptation ({reception {wasteAcceptation}}) est REFUSED signBsdasri (RECEPTION) passe le dasri \xe0 l'\xe9tat REFUSED")),(0,s.kt)("h2",{id:"\xe9tats-du-dasri"},"\xc9tats du DASRI"),(0,s.kt)("p",null,"L'ensemble des champs du BSD num\xe9rique est d\xe9crit dans la ",(0,s.kt)("a",{parentName:"p",href:"../api-reference/bsdasri/objects#bsdasri"},"r\xe9f\xe9rence de l'API"),". Au cours de son cycle de vie, un BSD num\xe9rique peut passer par diff\xe9rents \xe9tats d\xe9crits ",(0,s.kt)("a",{parentName:"p",href:"../api-reference/bsdasri/enums#bsdasristatus"},"ici"),"."),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"INITIAL")," (initial): C'est l'\xe9tat dans lequel le dasri est cr\xe9\xe9. ",(0,s.kt)("inlineCode",{parentName:"li"},"readableId")," est affect\xe9."),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"SIGNED_BY_PRODUCER")," (pr\xeat \xe0 \xeatre emport\xe9) : Dasri sign\xe9 par l'\xe9metteur"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"SENT")," (envoy\xe9): DASRI en transit vers l'installation de destination, d'entreposage ou de reconditionnement"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"RECEIVED")," (re\xe7u): DASRI re\xe7u sur l'installation de destination, d'entreposage ou de reconditionnement"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"ACCEPTED")," (accept\xe9): DASRI accept\xe9 sur l'installation de destination, d'entreposage ou de reconditionnement"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"PROCESSED")," (trait\xe9): DASRI dont l'op\xe9ration de traitement a \xe9t\xe9 effectu\xe9"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"REFUSED")," (refus\xe9): DASRI refus\xe9, par le tranporteur ou le destinataire")),(0,s.kt)("p",null,"Le diagramme ci dessous retrace le cycle de vie d'un DASRI dans Trackd\xe9chets:"),(0,s.kt)(r.Z,{chart:'\ngraph TD\nAO(NO STATE) --\x3e|createDraftBsdasri| A\nAO(NO STATE) --\x3e|createBsdasri| B\nA --\x3e|"updateBsdasri (tous les champs)"| A\nB --\x3e|"updateBsdasri (tous les champs)"| B\nC--\x3e|"updateBsdasri (sauf champs sign\xe9s)"| C\nD--\x3e|"updateBsdasri (sauf champs sign\xe9s)"| D\nE--\x3e|"updateBsdasri (sauf champs sign\xe9s)"| E\nA["INITIAL (isDraft=true)"] --\x3e|publishBsdasri| B("INITIAL (isDraft=false)")\nB --\x3e|"signBsdasri (EMISSION / EMISSION_WITH_SECRET_CODE)"| C(SIGNED_BY_PRODUCER)\nB --\x3e|"signBsdasri (TRANSPORT) - si autoris\xe9 par \xe9metteur" | D(SENT)\nC --\x3e|"signBsdasri (TRANSPORT)"| D(SENT)\nD --\x3e|"signBsdasri (RECEPTION)"| E(RECEIVED)\nE --\x3e|"signBsdasri (OPERATION)"| F(PROCESSED)\nD --\x3e|"signBsdasri (TRANSPORT *)"| G(REFUSED)\nC --\x3e|"signBsdasri (RECEPTION *)"| G(REFUSED)\n',mdxType:"Mermaid"}),(0,s.kt)("p",null," ","*"," si champ wasteAcceptation correspondant  est REFUSED"))}c.isMDXComponent=!0},11748:function(e,t,a){var i={"./locale":89234,"./locale.js":89234};function n(e){var t=s(e);return a(t)}function s(e){if(!a.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}n.keys=function(){return Object.keys(i)},n.resolve=s,e.exports=n,n.id=11748}}]);