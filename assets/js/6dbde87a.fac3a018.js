"use strict";(self.webpackChunktrackdechets=self.webpackChunktrackdechets||[]).push([[8528],{5311:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>c,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"guides/oauth2","title":"Cr\xe9er une application OAuth2","description":"Avant de pouvoir impl\xe9menter le procotole OAuth2, vous aurez besoin d\'une application sur la plateforme Trackd\xe9chets. Vous pouvez cr\xe9er une application depuis votre compte Trackd\xe9chets dans la section Mon Compte > D\xe9veloppeurs > Mes Applications.","source":"@site/docs/guides/oauth2.md","sourceDirName":"guides","slug":"/guides/oauth2","permalink":"/guides/oauth2","draft":false,"unlisted":false,"editUrl":"https://github.com/MTES-MCT/trackdechets/edit/dev/doc/docs/guides/oauth2.md","tags":[],"version":"current","frontMatter":{"title":"Cr\xe9er une application OAuth2"},"sidebar":"docs","previous":{"title":"Rechercher un \xe9tablissement partenaire sur l\'API Trackd\xe9chets","permalink":"/guides/sirene"},"next":{"title":"Utiliser le protocole OpenID Connect","permalink":"/guides/openidconnect"}}');var r=n(4848),s=n(8453);const o={title:"Cr\xe9er une application OAuth2"},c=void 0,a={},l=[];function d(e){const t={a:"a",admonition:"admonition",code:"code",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.admonition,{type:"note",children:(0,r.jsx)(t.p,{children:"Avant de pouvoir impl\xe9menter le procotole OAuth2, vous aurez besoin d'une application sur la plateforme Trackd\xe9chets. Vous pouvez cr\xe9er une application depuis votre compte Trackd\xe9chets dans la section Mon Compte > D\xe9veloppeurs > Mes Applications."})}),"\n",(0,r.jsxs)(t.p,{children:["Le ",(0,r.jsx)(t.a,{href:"https://tools.ietf.org/html/rfc6749",children:"protocole OAuth2"}),' permet \xe0 des logiciels tiers type SaaS d\xe9chets ("client") d\'acc\xe9der \xe0 l\'API Trackd\xe9chets ("ressource server") pour le compte d\'utilisateurs ("ressource owner") sans exposer le mot de passe de celui-ci.']}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"     +--------+                               +---------------+\n     |        |--(A)- Authorization Request ->|   Resource    |\n     |        |                               |     Owner     |\n     |        |<-(B)-- Authorization Grant ---|               |\n     |        |                               +---------------+\n     |        |\n     |        |                               +---------------+\n     |        |--(C)-- Authorization Grant --\x3e| Authorization |\n     | Client |                               |     Server    |\n     |        |<-(D)----- Access Token -------|               |\n     |        |                               +---------------+\n     |        |\n     |        |                               +---------------+\n     |        |--(E)----- Access Token ------\x3e|    Resource   |\n     |        |                               |     Server    |\n     |        |<-(F)--- Protected Resource ---|               |\n     +--------+                               +---------------+\n\n                    Abstract Protocol Flow\n"})}),"\n",(0,r.jsxs)(t.p,{children:['Seul le "grant" par \xe9change de code d\'autorisation est impl\xe9ment\xe9 dans Trackd\xe9chets ',(0,r.jsx)(t.a,{href:"https://tools.ietf.org/html/rfc6749#section-4.1",children:"https://tools.ietf.org/html/rfc6749#section-4.1"}),". Le sch\xe9ma de flux est le suivant :"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"     +----------+\n     | Resource |\n     |   Owner  |\n     |          |\n     +----------+\n          ^\n          |\n         (B)\n     +----|-----+          Client Identifier      +---------------+\n     |         -+----(A)-- & Redirection URI ----\x3e|               |\n     |  User-   |                                 | Authorization |\n     |  Agent  -+----(B)-- User authenticates ---\x3e|     Server    |\n     |          |                                 |               |\n     |         -+----(C)-- Authorization Code ---<|               |\n     +-|----|---+                                 +---------------+\n       |    |                                         ^      v\n      (A)  (C)                                        |      |\n       |    |                                         |      |\n       ^    v                                         |      |\n     +---------+                                      |      |\n     |         |>---(D)-- Authorization Code ---------'      |\n     |  Client |          & Redirection URI                  |\n     |         |                                             |\n     |         |<---(E)----- Access Token -------------------'\n     +---------+\n\n   Note: The lines illustrating steps (A), (B), and (C) are broken into\n   two parts as they pass through the user-agent.\n\n                     Authorization Code Flow\n"})}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["(A) L'application cliente initie le protocole en redirigeant l'utilisateur (\"resource owner\") sur l'URL d'autorisation Trackd\xe9chets ",(0,r.jsx)(t.code,{children:"https://app.trackdechets.beta.gouv.fr/oauth2/authorize/dialog"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:['Les arguments suivants doivent \xeatre pass\xe9s en "query string" de la requ\xeate (Cf ',(0,r.jsx)(t.a,{href:"https://tools.ietf.org/html/rfc6749#section-4.1.1",children:"https://tools.ietf.org/html/rfc6749#section-4.1.1"}),") :"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"client_id={client_id}"})," : L'identifiant de l'application cliente"]}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.code,{children:"response_type=code"})}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"redirect_uri={redirect_uri}"})," : URL de redirection"]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["Exemple : ",(0,r.jsx)(t.code,{children:"https://app.trackdechets.beta.gouv.fr/oauth2/authorize/dialog?response_type=code&redirect_uri=https://client.example.com/cb&client_id=ck7d66y9s00x20784u4u7fp8l"})]}),"\n",(0,r.jsxs)(t.p,{children:["Si la requ\xeate \xe9choue \xe0 cause d'un param\xe8tre invalide, une erreur est retourn\xe9e ",(0,r.jsx)(t.a,{href:"https://tools.ietf.org/html/rfc6749#section-4.1.2.1",children:"https://tools.ietf.org/html/rfc6749#section-4.1.2.1"})]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"(B) Le serveur d'autorisation authentifie l'utilisateur via le navigateur (\"resource owner\") et \xe9tablit si oui ou non l'utilisateur autorise ou non l'application autorise l'acc\xe8s."}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"oauth2-dialog.png",src:n(159).A+"",width:"882",height:"563"})}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["(C) Si l'utilisateur donne acc\xe8s, le serveur d'autorisation redirige l'utilisateur vers l'application cliente en utilisant l'URL de redirection fournit \xe0 l'\xe9tape (A) ",(0,r.jsx)(t.a,{href:"https://tools.ietf.org/html/rfc6749#section-4.1.2",children:"https://tools.ietf.org/html/rfc6749#section-4.1.2"}),". L'URL de redirection inclut un code d'autorisation avec une dur\xe9e de validit\xe9 de 10 minutes. Par exemple : ",(0,r.jsx)(t.code,{children:"https://client.example.com/cb?code=SplxlOBeZQQYbYS6WxSbIA"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["(D) L'application cliente demande un jeton d'acc\xe8s au serveur d'autorisation en incluant le code d'autorisation re\xe7u \xe0 l'\xe9tape pr\xe9c\xe9dente en faisant un ",(0,r.jsx)(t.code,{children:"POST"})," sur l'URL ",(0,r.jsx)(t.code,{children:"https://api.trackdechets.beta.gouv.fr/oauth2/token"}),". Cf ",(0,r.jsx)(t.a,{href:"https://tools.ietf.org/html/rfc6749#section-4.1.3",children:"https://tools.ietf.org/html/rfc6749#section-4.1.3"}),'. Les param\xe8tres suivants doivent \xeatre pass\xe9s en utilisant le format "application/x-www-form-urlencoded".']}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.code,{children:"grant_type=authorization_code"})}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"code={code}"})," code re\xe7u \xe0 l'\xe9tape pr\xe9c\xe9dente"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"redirect_uri={redirect_uri}"})," URL de redirection sp\xe9cifi\xe9 \xe0 l'\xe9tape (A)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["La requ\xeate doit \xeatre authentifi\xe9e avec le ",(0,r.jsx)(t.code,{children:"client_id"})," et ",(0,r.jsx)(t.code,{children:"client_secret"})," (",(0,r.jsx)(t.a,{href:"https://fr.wikipedia.org/wiki/Authentification_HTTP#M%C3%A9thode_%C2%AB_Basic_%C2%BB",children:"m\xe9thode basique"}),")."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-http",children:"POST /oauth2/token HTTP/1.1\nHost: api.trackdechets.beta.gouv.fr\nAuthorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW\nContent-Type: application/x-www-form-urlencoded\n\ngrant_type=authorization_code&code=SplxlOBeZQQYbYS6WxSbIA\n&redirect_uri=https://client.example.com/cb\n"})}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"(E) Si la requ\xeate est valide et autoris\xe9e, le serveur d'autorisation \xe9met un jeton d'acc\xe8s. Par exemple :"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-http",children:'HTTP/1.1 200 OK\nContent-Type: application/json;charset=UTF-8\nCache-Control: no-store\nPragma: no-cache\n\n{\n  "access_token":"*****************",\n  "token_type":"bearer",\n    "user": {\n      "email": "foo@bar.com",\n      "name": "Foo Bar"\n    }\n}\n'})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Le token \xe9mit a une dur\xe9e de vie infinie, il n'y a pas besoin de le rafraichir"}),". Il pourra toutefois \xeatre r\xe9voqu\xe9 par l'utilisateur dans son espace client Trackd\xe9chets."]}),"\n",(0,r.jsx)(t.p,{children:"Vous pouvez ensuite stocker ce token et l'utiliser pour acc\xe9der aux ressources de l'utilisateur sur la plateforme Trackd\xe9chets."}),"\n",(0,r.jsxs)(t.p,{children:["Si la requ\xeate \xe9choue, le serveur r\xe9pond par un message d'erreur tel que d\xe9crit ",(0,r.jsx)(t.a,{href:"https://tools.ietf.org/html/rfc6749#section-5.2",children:"ici"}),"."]}),"\n",(0,r.jsx)(t.admonition,{type:"tip",children:(0,r.jsxs)(t.p,{children:["Une application OAuth2 de d\xe9monstration a \xe9t\xe9 cr\xe9\xe9e \xe0 l'adresse ",(0,r.jsx)(t.a,{href:"https://td-oauth2-demo.osc-fr1.scalingo.io/",children:"https://td-oauth2-demo.osc-fr1.scalingo.io/"})]})})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},159:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/oauth2-dialog-4cb88af95a355bb29ffdbd42354af730.png"},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>c});var i=n(6540);const r={},s=i.createContext(r);function o(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);