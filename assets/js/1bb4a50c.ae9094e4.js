"use strict";(self.webpackChunktd_doc=self.webpackChunktd_doc||[]).push([[7841],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=o.createContext({}),u=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=u(e.components);return o.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,p=a(e,["components","mdxType","originalType","parentName"]),d=u(n),m=r,k=d["".concat(l,".").concat(m)]||d[m]||c[m]||i;return n?o.createElement(k,s(s({ref:t},p),{},{components:n})):o.createElement(k,s({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,s=new Array(i);s[0]=d;var a={};for(var l in t)hasOwnProperty.call(t,l)&&(a[l]=t[l]);a.originalType=e,a.mdxType="string"==typeof e?e:r,s[1]=a;for(var u=2;u<i;u++)s[u]=n[u];return o.createElement.apply(null,s)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},9060:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>c,frontMatter:()=>i,metadata:()=>a,toc:()=>u});var o=n(3117),r=(n(7294),n(3905));const i={title:"Utiliser les webhooks"},s=void 0,a={unversionedId:"guides/webhooks",id:"guides/webhooks",title:"Utiliser les webhooks",description:"Cette fonctionalit\xe9 est en phase de beta test.",source:"@site/docs/guides/webhooks.md",sourceDirName:"guides",slug:"/guides/webhooks",permalink:"/guides/webhooks",draft:!1,editUrl:"https://github.com/MTES-MCT/trackdechets/edit/dev/doc/docs/guides/webhooks.md",tags:[],version:"current",frontMatter:{title:"Utiliser les webhooks"},sidebar:"docs",previous:{title:"Utiliser le protocole OpenID Connect",permalink:"/guides/openidconnect"},next:{title:"Queries",permalink:"/reference/api-reference/bsda/queries"}},l={},u=[{value:"Principes:",id:"principes",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Mise en place du endpoint",id:"mise-en-place-du-endpoint",level:3},{value:"D\xe9sactivation des webhooks",id:"d\xe9sactivation-des-webhooks",level:3},{value:"R\xe9ception des webhooks",id:"r\xe9ception-des-webhooks",level:2},{value:"Payload du webhook",id:"payload-du-webhook",level:3},{value:"S\xe9curit\xe9",id:"s\xe9curit\xe9",level:3}],p={toc:u};function c(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Cette fonctionalit\xe9 est en phase de beta test.")),(0,r.kt)("p",null,"Les webhooks permettent \xe0 un SI d'un utilisateur Trackd\xe9chets d'\xeatre notifi\xe9 d'un changement (cr\xe9ation modification, suppression) d'un bordereau sur leqel il figure."),(0,r.kt)("p",null,"L'utilisation des webhooks permet aux SI de limiter les lectures p\xe9riodiques de l'api Trackd\xe9chets."),(0,r.kt)("h2",{id:"principes"},"Principes:"),(0,r.kt)("p",null,"Pour recevoir des webhooks vous devez:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"les configurer gr\xe2ce \xe0 l'api des webhookSettings"),(0,r.kt)("li",{parentName:"ul"},"permettre \xe0 votre SI de recevoir les requ\xeates HTTP de Trackd\xe9chets"),(0,r.kt)("li",{parentName:"ul"},"effectuer des modifications ou attendre que d'autres acteurs en fassent sur des bsds comprenant les \xe9tablissements correpondant aux webhookSettings."),(0,r.kt)("li",{parentName:"ul"})),(0,r.kt)("h2",{id:"configuration"},"Configuration"),(0,r.kt)("p",null,"L'api des webhookSettings vous permet de configurer l'envoi des webhooks"),(0,r.kt)("p",null,"Principes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"l'api est accessible aux utilisateurs ADMIN"),(0,r.kt)("li",{parentName:"ul"},"Un webhook maximum par \xe9tablissement"),(0,r.kt)("li",{parentName:"ul"},"une url de notification par webhook"),(0,r.kt)("li",{parentName:"ul"},"un token d'au moins 20 caract\xe8res est requis \xe0 la cr\xe9ation du webhookSetting, il sera pass\xe9 en header de la requ\xeate du webhook (Authorization: Bearer: token)"),(0,r.kt)("li",{parentName:"ul"},"le token n'est pas lisible par les queries, mais vous pouvez le mettre \xe0 jour \xe0 tout moment"),(0,r.kt)("li",{parentName:"ul"},"l'id de l'\xe9tablissement n'est pas modifiable")),(0,r.kt)("h3",{id:"mise-en-place-du-endpoint"},"Mise en place du endpoint"),(0,r.kt)("p",null,"Votre SI doit \xeatre en mesure de recevoir les appels HTTP de Trackd\xe9chets"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://monentreprise.fr/webhooks/"},"https://monentreprise.fr/webhooks/"))),(0,r.kt)("p",null,"Vous pouvez associer une url \xe0 chaque siret si vous \xeates ADMIN de plusieurs \xe9tablissements"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://monentreprise.fr/webhooks/siret1"},"https://monentreprise.fr/webhooks/siret1")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://monentreprise.fr/webhooks/siret2"},"https://monentreprise.fr/webhooks/siret2"))),(0,r.kt)("h3",{id:"d\xe9sactivation-des-webhooks"},"D\xe9sactivation des webhooks"),(0,r.kt)("p",null,"Le endpoint doit toujours r\xe9pondre par un status code HTTP 200. Dans le cas contraire, nous consid\xe9rons que votre SI est en avarie. \xc0 la suite d'un nombre trop important de r\xe9ponses non conformes (plus de 5 en 10mn), le webhooks est automatiquement d\xe9sactiv\xe9"),(0,r.kt)("p",null,"Vous pourrez le r\xe9activer par une mutation d'update."),(0,r.kt)("h2",{id:"r\xe9ception-des-webhooks"},"R\xe9ception des webhooks"),(0,r.kt)("h3",{id:"payload-du-webhook"},"Payload du webhook"),(0,r.kt)("p",null,'Le payload est minimal: il est sous la forme d\'un tableau JSON contenant un object {"action", "id"}.'),(0,r.kt)("p",null,'L\'ID correspondant \xe0 l\'identifiant lisible du bsd, l\'action \xe9tant une des cha\xeenes suivantes: "CREATED", "UPDATED", "DELETED".'),(0,r.kt)("p",null,"Actuellement un seul objet est renvoy\xe9 dans le tableau, \xe0 l'avenir il est possible que nous groupions les informations de plusieurs bsds dans un m\xeame webhook."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'POST / HTTP/1.1\n\nHost: votre-si.com\nConnection: close\nAccept: application/json, text/plain, */*\nAuthorization: Bearer: votre-token\nConnection: close\nContent-Length: 52\nContent-Type: application/json\n[{"action":"CREATED","id":"BSD-20230412-JYE9095HY"}]\n')),(0,r.kt)("p",null,'NB: Si votre siret est retir\xe9 d\'un BSD ou ajout\xe9 \xe0 un BSD existant, vous recevrez une action "UPDATED"'),(0,r.kt)("h3",{id:"s\xe9curit\xe9"},"S\xe9curit\xe9"),(0,r.kt)("p",null,"Un token est requis pour configurer vos webhooks, n\xe9anmoins vous \xeates responsables de l'impl\xe9mentation du contr\xf4le d'acc\xe8s sur votre SI.\nGardez en m\xe9moire qu'un enpoint non prot\xe9g\xe9 repr\xe9sente un risque pour votre SI et pour Trackd\xe9chets."))}c.isMDXComponent=!0}}]);