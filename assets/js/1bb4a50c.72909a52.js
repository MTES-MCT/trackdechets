"use strict";(self.webpackChunktd_doc=self.webpackChunktd_doc||[]).push([[7841],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>k});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var u=o.createContext({}),l=function(e){var t=o.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=l(e.components);return o.createElement(u.Provider,{value:t},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,u=e.parentName,c=a(e,["components","mdxType","originalType","parentName"]),d=l(n),m=r,k=d["".concat(u,".").concat(m)]||d[m]||p[m]||i;return n?o.createElement(k,s(s({ref:t},c),{},{components:n})):o.createElement(k,s({ref:t},c))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,s=new Array(i);s[0]=m;var a={};for(var u in t)hasOwnProperty.call(t,u)&&(a[u]=t[u]);a.originalType=e,a[d]="string"==typeof e?e:r,s[1]=a;for(var l=2;l<i;l++)s[l]=n[l];return o.createElement.apply(null,s)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},9060:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>s,default:()=>p,frontMatter:()=>i,metadata:()=>a,toc:()=>l});var o=n(7462),r=(n(7294),n(3905));const i={title:"Utilisation des Webhooks de l'API Trackd\xe9chets"},s=void 0,a={unversionedId:"guides/webhooks",id:"guides/webhooks",title:"Utilisation des Webhooks de l'API Trackd\xe9chets",description:"Les Webhooks permettent au Syst\xe8me d'Information (SI) d'un utilisateur Trackd\xe9chets de recevoir des notifications lorsqu'un bordereau auquel il est associ\xe9 subit une modification (cr\xe9ation, modification ou suppression).",source:"@site/docs/guides/webhooks.md",sourceDirName:"guides",slug:"/guides/webhooks",permalink:"/guides/webhooks",draft:!1,editUrl:"https://github.com/MTES-MCT/trackdechets/edit/dev/doc/docs/guides/webhooks.md",tags:[],version:"current",frontMatter:{title:"Utilisation des Webhooks de l'API Trackd\xe9chets"},sidebar:"docs",previous:{title:"Utiliser le protocole OpenID Connect",permalink:"/guides/openidconnect"},next:{title:"Queries",permalink:"/reference/api-reference/bsda/queries"}},u={},l=[{value:"Principes:",id:"principes",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Configuration du point de terminaison (endpoint)",id:"configuration-du-point-de-terminaison-endpoint",level:3},{value:"D\xe9sactivation des Webhooks",id:"d\xe9sactivation-des-webhooks",level:3},{value:"R\xe9ception des Webhooks",id:"r\xe9ception-des-webhooks",level:2},{value:"Payload du Webhook",id:"payload-du-webhook",level:3},{value:"S\xe9curit\xe9",id:"s\xe9curit\xe9",level:3}],c={toc:l},d="wrapper";function p(e){let{components:t,...n}=e;return(0,r.kt)(d,(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Les Webhooks permettent au Syst\xe8me d'Information (SI) d'un utilisateur Trackd\xe9chets de recevoir des notifications lorsqu'un bordereau auquel il est associ\xe9 subit une modification (cr\xe9ation, modification ou suppression)."),(0,r.kt)("p",null,"L'utilisation des Webhooks permet aux Syst\xe8mes d'Information de r\xe9duire la n\xe9cessit\xe9 de faire des lectures p\xe9riodiques de l'API Trackd\xe9chets."),(0,r.kt)("h2",{id:"principes"},"Principes:"),(0,r.kt)("p",null,"Pour recevoir des Webhooks, vous devez suivre ces \xe9tapes :"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Configurer les Webhooks en utilisant l'API des ",(0,r.kt)("a",{parentName:"li",href:"../reference/api-reference/webhooks/mutations#createwebhooksetting"},'"WebhookSettings"'),"."),(0,r.kt)("li",{parentName:"ol"},"Autoriser votre SI \xe0 recevoir des requ\xeates HTTP de Trackd\xe9chets."),(0,r.kt)("li",{parentName:"ol"},'Effectuer des modifications sur les bordereaux contenant les \xe9tablissements correspondants aux "WebhookSettings" ou attendre que d\'autres acteurs le fassent.'),(0,r.kt)("li",{parentName:"ol"},"Recevez la requ\xeate dde notification de mise \xe0 jour sur l'URL de votre SI configur\xe9 comme Webhook.")),(0,r.kt)("h2",{id:"configuration"},"Configuration"),(0,r.kt)("p",null,"L'API des \"WebhookSettings\" vous permet de configurer l'envoi des Webhooks avec les principes suivants :"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"L'API est accessible uniquement aux utilisateurs ADMIN."),(0,r.kt)("li",{parentName:"ul"},"Un seul Webhook est autoris\xe9 par \xe9tablissement (identifi\xe9 par ",(0,r.kt)("a",{parentName:"li",href:"../reference/api-reference/webhooks/inputObjects#webhooksettingcreateinput"},(0,r.kt)("inlineCode",{parentName:"a"},"companyId")),")."),(0,r.kt)("li",{parentName:"ul"},"Une URL de notification sur votre SI est associ\xe9e \xe0 chaque Webhook."),(0,r.kt)("li",{parentName:"ul"},"Un token d'au moins 20 caract\xe8res est requis lors de la cr\xe9ation du \"WebhookSetting\" et sera transmis en tant qu'en-t\xeate de la requ\xeate du Webhook (Authorization: Bearer: token)."),(0,r.kt)("li",{parentName:"ul"},"Le token n'est pas visible dans les requ\xeates, mais vous pouvez le mettre \xe0 jour \xe0 tout moment."),(0,r.kt)("li",{parentName:"ul"},"L'identifiant de l'\xe9tablissement ne peut pas \xeatre modifi\xe9.")),(0,r.kt)("h3",{id:"configuration-du-point-de-terminaison-endpoint"},"Configuration du point de terminaison (endpoint)"),(0,r.kt)("p",null,"Votre SI doit \xeatre capable de recevoir les appels HTTP ou HTTPS de Trackd\xe9chets \xe0 l'adresse suivante :"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://monentreprise.fr/webhooks/"},"https://monentreprise.fr/webhooks/"))),(0,r.kt)("p",null,"Si vous \xeates administrateur de plusieurs \xe9tablissements, vous pouvez associer une URL distincte \xe0 chaque SIRET :"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://monentreprise.fr/webhooks/siret1"},"https://monentreprise.fr/webhooks/siret1")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://monentreprise.fr/webhooks/siret2"},"https://monentreprise.fr/webhooks/siret2"))),(0,r.kt)("h3",{id:"d\xe9sactivation-des-webhooks"},"D\xe9sactivation des Webhooks"),(0,r.kt)("p",null,'L\'URL du point de terminaison ("endpoint") doit toujours renvoyer un code HTTP 200. Dans le cas contraire, nous consid\xe9rons que votre SI rencontre un dysfonctionnement. Apr\xe8s un certain nombre de r\xe9ponses non conformes (plus de 5 en 10 minutes), le Webhook est automatiquement d\xe9sactiv\xe9. Vous pourrez le r\xe9activer en utilisant une mutation de mise \xe0 jour.'),(0,r.kt)("h2",{id:"r\xe9ception-des-webhooks"},"R\xe9ception des Webhooks"),(0,r.kt)("h3",{id:"payload-du-webhook"},"Payload du Webhook"),(0,r.kt)("p",null,'Le payload est minimal et se pr\xe9sente sous la forme d\'un tableau JSON contenant un objet {"action", "id"}. L\'ID correspond \xe0 l\'identifiant lisible du bordereau de suivi des d\xe9chets (BSD), et l\'action peut \xeatre l\'une des cha\xeenes suivantes : "CREATED", "UPDATED", "DELETED". Actuellement, un seul objet est renvoy\xe9 dans le tableau, mais \xe0 l\'avenir, il est possible que nous regroupions les informations de plusieurs BSD dans un seul Webhook.'),(0,r.kt)("p",null,"Exemple de requ\xeate :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'POST / HTTP/1.1\n\nHost: votre-si.com\nConnection: close\nAccept: application/json, text/plain, */*\nAuthorization: Bearer: votre-token\nConnection: close\nContent-Length: 52\nContent-Type: application/json\n[{"action":"CREATED","id":"BSD-20230412-JYE9095HY"}]\n')),(0,r.kt)("p",null,'Remarque: Si votre SIRET est retir\xe9 d\'un BSD ou ajout\xe9 \xe0 un BSD existant, vous recevrez une action "UPDATED".'),(0,r.kt)("h3",{id:"s\xe9curit\xe9"},"S\xe9curit\xe9"),(0,r.kt)("p",null,"Un token est requis pour configurer vos Webhooks, cependant, vous \xeates responsables de la mise en place du contr\xf4le d'acc\xe8s sur votre SI. Assurez-vous qu'un endpoint non prot\xe9g\xe9 repr\xe9sente un risque de s\xe9curit\xe9 pour votre SI et pour Trackd\xe9chets."))}p.isMDXComponent=!0}}]);