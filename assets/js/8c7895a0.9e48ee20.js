"use strict";(self.webpackChunktd_doc=self.webpackChunktd_doc||[]).push([[1954],{3905:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>c});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var p=n.createContext({}),i=function(e){var t=n.useContext(p),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},u=function(e){var t=i(e.components);return n.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,s=e.originalType,p=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),m=i(r),c=a,f=m["".concat(p,".").concat(c)]||m[c]||d[c]||s;return r?n.createElement(f,l(l({ref:t},u),{},{components:r})):n.createElement(f,l({ref:t},u))}));function c(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var s=r.length,l=new Array(s);l[0]=m;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:a,l[1]=o;for(var i=2;i<s;i++)l[i]=r[i];return n.createElement.apply(null,l)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},1491:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>i});var n=r(3117),a=(r(7294),r(3905));const s={title:"Erreurs"},l=void 0,o={unversionedId:"reference/errors",id:"reference/errors",title:"Erreurs",description:"Formattage des erreurs",source:"@site/docs/reference/errors.md",sourceDirName:"reference",slug:"/reference/errors",permalink:"/reference/errors",draft:!1,editUrl:"https://github.com/MTES-MCT/trackdechets/edit/dev/doc/docs/reference/errors.md",tags:[],version:"current",frontMatter:{title:"Erreurs"},sidebar:"docs",previous:{title:"Hi\xe9rarchie des modes de traitement",permalink:"/reference/operationModes"},next:{title:"Notifications",permalink:"/reference/notifications"}},p={},i=[{value:"Formattage des erreurs",id:"formattage-des-erreurs",level:2},{value:"Liste des codes erreur GraphQL",id:"liste-des-codes-erreur-graphql",level:2},{value:"Liste des codes HTTP",id:"liste-des-codes-http",level:2}],u={toc:i};function d(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,n.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"formattage-des-erreurs"},"Formattage des erreurs"),(0,a.kt)("p",null,"Dans le cas o\xf9 une erreur a lieu avant ou pendant l'ex\xe9cution d'une requ\xeate GraphQL, un champ ",(0,a.kt)("inlineCode",{parentName:"p"},"errors")," sera pr\xe9sent dans le corps de la r\xe9ponse. Ce champ correspond \xe0 une liste non vide d'erreurs format\xe9es de la fa\xe7on suivante:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "errors": [\n    {\n      "message": "Vous n\'\xeates pas authentifi\xe9",\n      "extensions": {\n        "code": "UNAUTHENTICATED"\n      }\n    }\n  ]\n}\n')),(0,a.kt)("p",null,"Voir ",(0,a.kt)("a",{parentName:"p",href:"https://spec.graphql.org/June2018/#sec-Response-Format"},"GraphQL Response Format")," pour plus d'information sur le formattage des erreurs GraphQL."),(0,a.kt)("p",null,"Le champ ",(0,a.kt)("inlineCode",{parentName:"p"},"code")," permet au client de l'API d'\xeatre inform\xe9 du type d'erreur renvoy\xe9 et d'effectuer une action ad\xe9quate."),(0,a.kt)("h2",{id:"liste-des-codes-erreur-graphql"},"Liste des codes erreur GraphQL"),(0,a.kt)("p",null,"La liste des codes erreur utilis\xe9s est la suivante:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"GRAPHQL_PARSE_FAILED"),": Erreur de syntaxe dans la requ\xeate GraphQL. Exemple")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-graphql"},"query {\n  me  // accolade manquante\n    email\n  }\n}\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"GRAPHQL_VALIDATION_FAILED"),": La syntaxe de la requ\xeate GraphQL est correcte mais elle ne correspond pas au sch\xe9ma. Exemple:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-graphql"},"{\n  query {\n    me {\n      hair_color // le champ hair_color n'existe pas sur le type User\n    }\n  }\n}\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"UNAUTHENTICATED"),": Vous n'\xeates pas authentifi\xe9")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"FORBIDDEN"),": Vous n'avez pas les droits pour effectuer l'action d\xe9sir\xe9e. Exemple: vous essayez de finaliser un bordereau sur lesquel aucune entreprise dont vous \xeates membre n'apparait.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"BAD_USER_INPUT"),": La requ\xeate GraphQL est valide mais la valeur des arguments fournis ne l'est pas. Exemple: vous essayez de passer un SIRET qui ne fait pas 14 caract\xe8res.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"EXTERNAL_SERVICE_ERROR"),": La requ\xeate GraphQL est valide mais un service tiers externe \xe0 Trackd\xe9chets a renvoy\xe9 une erreur."))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-graphql"},'query {\n  companyInfos(siret: "123"){\n    siret\n  }\n}\n')),(0,a.kt)("p",null,"Dans le cas des erreurs ",(0,a.kt)("inlineCode",{parentName:"p"},"BAD_USER_INPUT")," un champ additionnel ",(0,a.kt)("inlineCode",{parentName:"p"},"invalidArgs")," pourra \xeatre pr\xe9sent dans la r\xe9ponse"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "errors": [\n    {\n      "message": "Le siret doit faire 14 caract\xe8res",\n      "extensions": {\n        "code": "BAD_USER_INPUT",\n        "invalidArgs": [\n          "siret"\n        ]\n      }\n    }\n  ]\n}\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"INTERNAL_SERVER_ERROR"),": Une erreur inconnue s'est produite. Ce code s'accompagne du message d'erreur \"Erreur serveur\"")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "errors": [\n    {\n      "message": "Erreur serveur",\n      "extensions": {\n        "code": "INTERNAL_SERVER_ERROR"\n      }\n    }\n  ]\n}\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"GRAPHQL_MAX_OPERATIONS_ERROR"),": La limite du nombre d'op\xe9rations GraphQL group\xe9es est d\xe9pass\xe9e.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "errors": [\n    {\n      "message": "Batching by query merging is limited to 5 operations per query.",\n      "extensions": {\n        "code": "GRAPHQL_MAX_OPERATIONS_ERROR"\n      }\n    }\n  ]\n}\n')),(0,a.kt)("h2",{id:"liste-des-codes-http"},"Liste des codes HTTP"),(0,a.kt)("p",null,"Ci-dessous un tableau r\xe9capitulatif des diff\xe9rents codes HTTP et codes GraphQL possibles :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:"left"},"Code HTTP"),(0,a.kt)("th",{parentName:"tr",align:"left"},"Code GraphQL"),(0,a.kt)("th",{parentName:"tr",align:"left"},"Erreur"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"200"),(0,a.kt)("td",{parentName:"tr",align:"left"},"UNAUTHENTICATED"),(0,a.kt)("td",{parentName:"tr",align:"left"},"Vous n'\xeates pas authentifi\xe9")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"200"),(0,a.kt)("td",{parentName:"tr",align:"left"},"FORBIDDEN"),(0,a.kt)("td",{parentName:"tr",align:"left"},"Vous n'avez pas les droits pour effectuer l'action d\xe9sir\xe9e")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"200"),(0,a.kt)("td",{parentName:"tr",align:"left"},"BAD_USER_INPUT"),(0,a.kt)("td",{parentName:"tr",align:"left"},"La requ\xeate GraphQL est valide mais la valeur des arguments fournis ne l'est pas")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"400"),(0,a.kt)("td",{parentName:"tr",align:"left"},"GRAPHQL_PARSE_FAILED"),(0,a.kt)("td",{parentName:"tr",align:"left"},"Erreur de syntaxe GraphQL")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"400"),(0,a.kt)("td",{parentName:"tr",align:"left"},"GRAPHQL_VALIDATION_FAILED"),(0,a.kt)("td",{parentName:"tr",align:"left"},"La syntaxe de la requ\xeate GraphQL est correcte mais elle ne correspond pas au sch\xe9ma")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"400"),(0,a.kt)("td",{parentName:"tr",align:"left"},"GRAPHQL_MAX_OPERATIONS_ERROR"),(0,a.kt)("td",{parentName:"tr",align:"left"},"La limite du nombre d'op\xe9rations GraphQL group\xe9es est d\xe9pass\xe9e.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"502"),(0,a.kt)("td",{parentName:"tr",align:"left"},"N/A"),(0,a.kt)("td",{parentName:"tr",align:"left"},"Le serveur GraphQL est indisponible")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"503"),(0,a.kt)("td",{parentName:"tr",align:"left"},"N/A"),(0,a.kt)("td",{parentName:"tr",align:"left"},"Le serveur GraphQL est indisponible")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"504"),(0,a.kt)("td",{parentName:"tr",align:"left"},"N/A"),(0,a.kt)("td",{parentName:"tr",align:"left"},"Le serveur GraphQL met trop de temps \xe0 r\xe9pondre")))),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},'Le code HTTP renvoy\xe9 par le serveur GraphQL est toujours 200 lorsque la requ\xeate GraphQL a \xe9t\xe9 "comprise" par le serveur (la syntaxe est bonne et la requ\xeate correspond au sch\xe9ma). ',(0,a.kt)("br",null),"\nEn cas d'indisponibilit\xe9 ou de surcharge du serveur GraphQL, l'erreur renvoy\xe9e provient du serveur proxy et ne comporte pas de code erreur GraphQL.")))}d.isMDXComponent=!0}}]);