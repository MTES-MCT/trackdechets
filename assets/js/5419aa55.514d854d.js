"use strict";(self.webpackChunktd_doc=self.webpackChunktd_doc||[]).push([[2208],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>m});var s=r(7294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(e,t){if(null==e)return{};var r,s,n=function(e,t){if(null==e)return{};var r,s,n={},i=Object.keys(e);for(s=0;s<i.length;s++)r=i[s],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)r=i[s],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var a=s.createContext({}),l=function(e){var t=s.useContext(a),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},c=function(e){var t=l(e.components);return s.createElement(a.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return s.createElement(s.Fragment,{},t)}},p=s.forwardRef((function(e,t){var r=e.components,n=e.mdxType,i=e.originalType,a=e.parentName,c=u(e,["components","mdxType","originalType","parentName"]),p=l(r),m=n,f=p["".concat(a,".").concat(m)]||p[m]||d[m]||i;return r?s.createElement(f,o(o({ref:t},c),{},{components:r})):s.createElement(f,o({ref:t},c))}));function m(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=r.length,o=new Array(i);o[0]=p;var u={};for(var a in t)hasOwnProperty.call(t,a)&&(u[a]=t[a]);u.originalType=e,u.mdxType="string"==typeof e?e:n,o[1]=u;for(var l=2;l<i;l++)o[l]=r[l];return s.createElement.apply(null,o)}return s.createElement.apply(null,r)}p.displayName="MDXCreateElement"},6943:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>a,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>u,toc:()=>l});var s=r(3117),n=(r(7294),r(3905));const i={title:"Consommer l'api - Bonnes pratiques"},o=void 0,u={unversionedId:"guides/good-practices",id:"guides/good-practices",title:"Consommer l'api - Bonnes pratiques",description:"L'api de Trackd\xe9chets \xe9tant ouverte \xe0 tous les acteurs du d\xe9chet, le volume de requ\xeates absorb\xe9es est devenu tr\xe8s cons\xe9quent.",source:"@site/docs/guides/good-practices.md",sourceDirName:"guides",slug:"/guides/good-practices",permalink:"/guides/good-practices",draft:!1,editUrl:"https://github.com/MTES-MCT/trackdechets/edit/dev/doc/docs/guides/good-practices.md",tags:[],version:"current",frontMatter:{title:"Consommer l'api - Bonnes pratiques"},sidebar:"docs",previous:{title:"Groupement de d\xe9chets amiante",permalink:"/tutoriels/examples/bsda/groupement"},next:{title:"Utiliser le playground",permalink:"/guides/playground"}},a={},l=[{value:"Comment proc\xe9der ?",id:"comment-proc\xe9der-",level:2},{value:"Utiliser la query forms",id:"utiliser-la-query-forms",level:3},{value:"Utiliser la query formsLifecycle.",id:"utiliser-la-query-formslifecycle",level:3},{value:"Utiliser les webhooks (\xe0 venir).",id:"utiliser-les-webhooks-\xe0-venir",level:3}],c={toc:l};function d(e){let{components:t,...r}=e;return(0,n.kt)("wrapper",(0,s.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"L'api de Trackd\xe9chets \xe9tant ouverte \xe0 tous les acteurs du d\xe9chet, le volume de requ\xeates absorb\xe9es est devenu tr\xe8s cons\xe9quent.\nAfin de garantir et faciliter un acc\xe8s \xe9quitable \xe0 tous les SI connect\xe9s, il vous est demand\xe9 d'appliquer au mieux certaines r\xe8gles pour limiter la charge sur l'api sans pour autant restreindre les requ\xeates n\xe9cessaires.\nPour limiter les abus nous pourrions \xeatre amen\xe9s \xe0 mettre en place des rate limits sp\xe9cifiques dans les semaines \xe0 venir."),(0,n.kt)("p",null,"Si certains consommateurs de l'api effectuent d\xe9j\xe0 l'interrogation de l'api de mani\xe8re efficace et intelligente, d'autres acteurs gagneraient \xe0 optimiser leurs processus."),(0,n.kt)("p",null,"Nos statistiques nous montrent que la requ\xeate ",(0,n.kt)("inlineCode",{parentName:"p"},"form")," est de loin la plus utilis\xe9e.\nIl est l\xe9gitime pour tout SI de requ\xeater l'api Trackd\xe9chets afin de prendre en compte toute \xe9volution des bsds dont il a la charge.\nEn revanche, effectuer des milliers de requ\xeates ",(0,n.kt)("inlineCode",{parentName:"p"},"form")," pour suivre chaque bordereau, et r\xe9p\xe9ter ces requ\xeates en continu, est inefficace et couteux en ressources, pour Trackd\xe9chets comme pour le SI."),(0,n.kt)("h2",{id:"comment-proc\xe9der-"},"Comment proc\xe9der ?"),(0,n.kt)("h3",{id:"utiliser-la-query-forms"},"Utiliser la query forms"),(0,n.kt)("p",null,"La requ\xeate ",(0,n.kt)("inlineCode",{parentName:"p"},"forms")," dispose d'un param\xe8tre updatedAfter. Vous pouvez ainsi v\xe9rifier par batch lesquels de vos bsdd ont \xe9t\xe9 mis \xe0 jour par intervalle de temps. \xc0 la suite de quoi, vous pouvez soit:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"r\xe9cup\xe9rer les ids des bsds mis \xe0 jour, puis requ\xeater individuellement ces bsds et r\xe9percuter les changements dans votre SI"),(0,n.kt)("li",{parentName:"ul"},"r\xe9cup\xe9rer le json complet des bsds dans la requ\xeate ",(0,n.kt)("inlineCode",{parentName:"li"},"forms")," pour exploiter directement le r\xe9sultat")),(0,n.kt)("p",null,"Dans les 2 cas, vous ne requ\xeaterez que les bordereaux mis \xe0 jour, ce qui constituera un gain significatif pour votre SI comme pour Trackd\xe9chets.\nCette m\xe9thode est applicable aux autres bordereaux en utilisant bsdas, bsdasris, bsffs, bsvhus."),(0,n.kt)("h3",{id:"utiliser-la-query-formslifecycle"},"Utiliser la query formsLifecycle."),(0,n.kt)("p",null,"La query ",(0,n.kt)("inlineCode",{parentName:"p"},"formsLifecycle")," renvoie les changements de statut des bordereaux de l'entreprise s\xe9lectionn\xe9e. Elle peut s'utiliser dans le m\xeame esprit que la requ\xeate ",(0,n.kt)("inlineCode",{parentName:"p"},"forms"),", seuls les bsds dont le statut a chang\xe9 dans l'intervalle de temps seront retourn\xe9s.\nCette requ\xeate n'existe aujourd'hui que pour les bsdds."),(0,n.kt)("h3",{id:"utiliser-les-webhooks-\xe0-venir"},"Utiliser les webhooks (\xe0 venir)."),(0,n.kt)("p",null,"Dans les semaines qui viennent, nous allons impl\xe9menter un syst\xe8me de webhooks pour notifier les SI qui le souhaitent des changements survenus sur leur jeu de bsds. Chaque SI abonn\xe9 pourra ainsi recevoir sur une url d\xe9di\xe9e la liste des bsds mis \xe0 jour en temps quasi-r\xe9\xe9l."))}d.isMDXComponent=!0}}]);