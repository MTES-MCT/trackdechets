type User {
  id: ID! @id
  isActive: Boolean @default(value: false)
  email: String! @unique
  password: String!
  name: String
  phone: String
  userType: Json

  companies: [Company] @relation(name: "UserCompanies")
  companyAssociations: [CompanyAssociation]

  gerepId: String

  createdAt: DateTime! @createdAt
  updatedAt: DateTime! @updatedAt
}

type CompanyAssociation {
  id: ID! @id

  user: User!
  company: Company! @relation(link: INLINE)
  role: UserRole!
}

enum UserRole {
  MEMBER
  ADMIN
}

type UserActivationHash {
  id: ID! @id
  user: User! @relation(link: TABLE)
  hash: String! @unique

  createdAt: DateTime! @createdAt
  updatedAt: DateTime! @updatedAt
}

type UserAccountHash {
  id: ID! @id
  email: String!
  companySiret: ID!
  role: UserRole!
  hash: String! @unique

  createdAt: DateTime! @createdAt
  updatedAt: DateTime! @updatedAt
}

type Company {
  id: ID! @id
  siret: String! @unique

  createdAt: DateTime! @createdAt
  updatedAt: DateTime! @updatedAt

  securityCode: Int!

  admin: User @relation(name: "CompanyAdmin", link: TABLE)

  user: [User] @relation(name: "UserCompanies")
}

type Form {
  id: ID! @id
  readableId: String @unique
  isDeleted: Boolean @default(value: false)

  owner: User! @relation(link: TABLE)
  createdAt: DateTime! @createdAt
  updatedAt: DateTime! @updatedAt

  # Workflow fields
  status: String @default(value: "DRAFT")
  sentAt: DateTime
  sentBy: String

  isAccepted: Boolean
  receivedBy: String
  receivedAt: DateTime
  quantityReceived: Float

  processedBy: String
  processedAt: String
  processingOperationDone: String
  processingOperationDescription: String
  noTraceability: Boolean

  # Next destination fields (frame 12)
  nextDestinationProcessingOperation: String
  nextDestinationDetails: String

  # Emitter fields
  emitterType: EmitterType
  emitterPickupSite: String

  emitterCompanyName: String
  emitterCompanySiret: String
  emitterCompanyAddress: String
  emitterCompanyContact: String
  emitterCompanyPhone: String
  emitterCompanyMail: String

  # Recipient fields
  recipientCap: String
  recipientProcessingOperation: String

  recipientCompanyName: String
  recipientCompanySiret: String
  recipientCompanyAddress: String
  recipientCompanyContact: String
  recipientCompanyPhone: String
  recipientCompanyMail: String

  # Transporter fields
  transporterCompanyName: String
  transporterCompanySiret: String

  transporterCompanyAddress: String
  transporterCompanyContact: String
  transporterCompanyPhone: String
  transporterCompanyMail: String
  transporterReceipt: String
  transporterDepartment: String
  transporterValidityLimit: DateTime
  transporterNumberPlate: String

  # Waste details fields
  wasteDetailsCode: String
  wasteDetailsName: String
  wasteDetailsOnuCode: String
  wasteDetailsPackagings: Json
  wasteDetailsOtherPackaging: String
  wasteDetailsNumberOfPackages: Int
  wasteDetailsQuantity: Float
  wasteDetailsQuantityType: QuantityType
  wasteDetailsConsistence: Consistence

  # Trader fields
  traderCompanyName: String
  traderCompanySiret: String

  traderCompanyAddress: String
  traderCompanyContact: String
  traderCompanyPhone: String
  traderCompanyMail: String
  traderReceipt: String
  traderDepartment: String
  traderValidityLimit: DateTime

  appendix2Forms: [Form]
}

enum EmitterType {
  PRODUCER
  OTHER
  APPENDIX1
  APPENDIX2
}

enum QuantityType {
  REAL
  ESTIMATED
}

enum Consistence {
  SOLID
  LIQUID
  GASEOUS
}

enum Status {
  DRAFT
  SEALED
  SENT
  RECEIVED
  PROCESSED
  AWAITING_GROUP
  GROUPED
  NO_TRACEABILITY
}
